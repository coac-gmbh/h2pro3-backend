build:
  docker:
    web: Dockerfile
    worker: Dockerfile
    scheduler: Dockerfile

run:
  web: gunicorn openbook.wsgi -b :$PORT
  scheduler: /usr/bin/supervisord -c /src/h2pro3/.docker/scheduler/supervisord.conf
  worker: /usr/bin/supervisord -c /src/h2pro3/.docker/worker/supervisord.conf

release:
  image: web
  command:
    - mkdir -p /src/h2pro3/local/ && echo $FIREBASE_CREDENTIALS > /src/h2pro3/local/h2-firebase-adminsdk.json && python manage.py collectstatic --noinput && python manage.py migrate
